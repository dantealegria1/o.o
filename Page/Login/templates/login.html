{% extends "base.html" %}

{% block title %} Login {% endblock %}

{% block content %}
    <h1>Login</h1>
    <form id="loginForm" method="post">{% csrf_token %}
        <div >
            <input class="input" type="text" name="name" placeholder="name" required>
        </div>
        
        <div>
            <input class="input" type="password" name="password" placeholder="Password" required>
        </div>
        <div>
            <button type="submit">Log in</button>
        </div>
    </form>
    <div>
        <p>Don't have a account?
        <a href="{% url 'signup' %}">Sign up</a>
        </p>
    </div>

    <!-- Include SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            var form = event.target;
            var formData = new FormData(form);

            fetch(form.action, {
                method: form.method,
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'User logged in',
                        text: 'Welcome!',
                    }).then(() => {
                        window.location.href = "{% url 'home' %}";
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message,
                    });
                }
            });
        });
    </script>
{% endblock %}
