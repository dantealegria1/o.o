{% extends "base.html" %} 
{% block title %} Login {% endblock %} 

{% block content %}
    <h1>Sign Up</h1>
    <form id="signupForm" method="post">{% csrf_token %}
        <input type="text" name="name" placeholder="name" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Sign Up</button>
    </form>
    <div>
        <p>Allready have an account?
        <a href="{% url 'login' %}">Log in</a>
        </p>
    </div>

    <!-- Include SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        document.getElementById('signupForm').addEventListener('submit', function(event) {
            event.preventDefault();
            var form = event.target;
            var formData = new FormData(form);

            fetch(form.action, {
                method: form.method,
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'User logged in',
                        text: 'Welcome!',
                    }).then(() => {
                        window.location.href = "{% url 'home' %}";
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message,
                    });
                }
            });
        });
    </script>
{% endblock %}